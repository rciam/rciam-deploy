---
##in format X.Y.Z
## make sure the corresponding templates/X.Y.Z folder and vars/keycloak/X.Y.Z.yml exist
keycloak_version: "15.0.2"

# if the keycloak archive is from the "stage" branch, then you might enable the wayf plugin (keycloak-theme-vanilla)
keycloak_archive_url: "https://github.com/keycloak/keycloak/releases/download/{{keycloak_version}}/keycloak-{{keycloak_version}}.tar.gz"

## if set to true, any existing installation will moved aside (not deleted) and the new keycloak from the archive will be installed.
## if a different database is defined, the installation will be a clear one. If the same (previous) database is used, it will upgrade to the new version.
keycloak_is_upgrade: false

keycloak_service_user: "keycloak"

keycloak_admin:
  user: "<SET AN ADMIN USER>"
  pass: "<SET AN ADMIN PASS>"

keycloak_db:
  name: "<KEYCLOAK DB NAME>"
  user: "<DB USERNAME>"
  pass: "<DB USER PASSWORD>"

keycloak_db_host: "{{ groups['db'][0] }}"
keycloak_proxy_host: "{{ groups['proxy'][0] }}"

keycloak_home: "/srv/keycloak"

keycloak_bind_address: "0.0.0.0"
keycloak_bind_port: "8080"

keycloak_java_opts: "-Xms1024m -Xmx2048m -XX:MaxPermSize=768m"


### plugins
### wayf plugin works ONLY with "stage" branch of keycloak (need to have commit fe055820980dbcb79d5aae2b4dce78b840b912b0)
#keycloak_plugins:
#  wayf:
#    enabled: true
#    installing_as: module # values: {hotdeploy | module}
#    name: "keycloak-theme-vanilla" #PLEASE, do not change this
#    jar_url: "<location of plugin jar>"
#    modulexml_url: "https://raw.githubusercontent.com/eosc-kc/keycloak-theme-vanilla/master/module.xml"
#    isTheme: true
#    add_to_realms:
#      - "master"
#  idp_hashedid_mapper:
#    enabled: true
#    installing_as: module # values: {hotdeploy | module}
#    name: "keycloak-idp-hashedId-mapper" #PLEASE, do not change this
#    jar_url: "<location of plugin jar>"
#    modulexml_url: "https://raw.githubusercontent.com/eosc-kc/keycloak-idp-hashedId-mapper/master/module.xml"
#    isTheme: false
#  orcid_idp:
#    enabled: true
#    installing_as: hotdeploy # values: {hotdeploy | module}
#    name: "orcid-idp"
#    jar_url: "https://github.com/eosc-kc/keycloak-orcid/releases/download/1.0.0/keycloak-orcid-1.0.0.jar"


### Remaining configuration (enc keys, social IdPs, AUP config, SMTP config, etc)
### you can have more than one realms configured here (if it doesn't exist, it will be created). just copy the format of the master and add it in the list.
### also, you can just comment out any of the {key, aup, smtp} sub trees and let the remaining get configured
config:
  realms:
    - name: master
      verifyEmail: true
      displayNameHtml: Keycloak
#      keys:
#        - name: "rsa-sig"
#          providerId: "rsa" #DO NOT CHANGE THIS
#          config:
#            privateKey:
#              - "MIIEvgIBADANBgkqhkiG9....."
#            certificate:
#              - "MIID2TCCAsGgAwIBAgIUX....."
#            algorithm:
#              - "RS256"
#            keyUse:
#              - "sig"
#            priority:
#              - 100
#            enabled:
#              - true
#            active:
#              - true
#        - name: "rsa-enc"
#          providerId: "rsa" #DO NOT CHANGE THIS
#          config:
#            privateKey:
#              - "MIIEvgIBADANBgkqhkiG9....."
#            certificate:
#              - "MIID2TCCAsGgAwIBAgIUX....."
#            algorithm:
#              - "RS256"
#            keyUse:
#              - "enc"
#            priority:
#              - 100
#            enabled:
#              - true
#            active:
#              - true
#        - name: "generate-rsa-enc"
#          providerId: "rsa-generated" #DO NOT CHANGE THIS
#          config:
#            algorithm:
#              - "RS256"
#            keySize:
#              - "2048"
#            keyUse:
#              - "enc"
#            priority:
#              - 100
#            enabled:
#              - true
#            active:
#              - true
#        - name: "generate-rsa-sig"
#          providerId: "rsa-generated" #DO NOT CHANGE THIS
#          config:
#            algorithm:
#              - "RS256"
#            keySize:
#              - "2048"
#            keyUse:
#              - "sig"
#            priority:
#              - 100
#            enabled:
#              - true
#            active:
#              - true
#        - name: "java-keystore-sig"
#          providerId: "java-keystore" #DO NOT CHANGE THIS
#          config:
#            keyUse:
#              - "sig"
#            priority:
#              - 100
#            enabled:
#              - true
#            active:
#              - true
#            algorithm:
#              - "RS256"
#            keystore:
#              - "<KEYSTORE_LOCAL_FILEPATH>"
#            keystorePassword:
#              - "<KEYSTORE_PASSWORD>"
#            keyAlias:
#              - "<KEY_ALIAS>"
#            keyPassword:
#              - "<KEY_PASSWORD>"
#        - name: "generate-hmac"
#          providerId: "hmac-generated" #DO NOT CHANGE THIS
#          config:
#            algorithm:
#              - "HS256"
#            secretSize:
#              - "64"
#            priority:
#              - 100
#            enabled:
#              - true
#            active:
#              - true
#        - name: "generate-aes"
#          providerId: "aes-generated" #DO NOT CHANGE THIS
#          config:
#            secretSize:
#              - "16"
#            priority:
#              - 100
#            enabled:
#              - true
#            active:
#              - true
#        - name: "generate-ecdsa"
#          providerId: "ecdsa-generated" #DO NOT CHANGE THIS
#          config:
#            ecdsaEllipticCurveKey:
#              - "P-256"
#            priority:
#              - 100
#            enabled:
#              - true
#            active:
#              - true
#      aup:
#        enabled: true
#        defaultAction: true
#        reset_every: 165  # it goes (reset_every * reset_every_multiplier) seconds
#        reset_every_multiplier: 3600 # use 3600 for hours, 86400 for days
#      smtp:
#        host: "smtp.example.com"
#        from_email: "noreply@example.com"
#        port: 25
#        ## values below are optional
#        enable_ssl: true
#        enable_starttls: true
#        from_name: ""
#        reply_to_name: ""
#        reply_to_email: ""
#        envelope_from: ""
#        auth_enabled: false
#        auth_username: ""
#        auth_password: ""
      federations:
        - providerId: "saml" # DO NOT CHANGE THIS!
          url: "<THE URL OF THE FEDERATION's XML>"
          alias: "<SET AN ALIAS>"
          updateFrequencyInMins: 1440
          config:
            nameIDPolicyFormat: "urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"
            principalType: "SUBJECT"
            postBindingAuthnRequest: "true"
            wantAuthnRequestsSigned: "true"
            wantAssertionsSigned: "true"
            wantAssertionsEncrypted: "true"
            multiplePrincipals: "[{\"principalType\":\"SUBJECT\",\"nameIDPolicyFormat\":\"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent\"}]"
          entityIdWhiteList:
            - "https://aaa.bbb.com/entity1"
          entityIdBlackList:
            - "https://aaa.bbb.com/entity2"
          registrationAuthorityWhiteList:
            - "registration-authority-1"
          registrationAuthorityBlackList:
            - "registration-authority-2"
          categoryWhiteList:
            attribute-name-1:
              - "attribute-value-1"
            attribute-name-2:
              - "attribute-value-2"
          categoryBlackList:
            attribute-name-1:
              - "attribute-value-1"
            attribute-name-2:
              - "attribute-value-2"
#      saml_idps:
#        - metadataUrl: "<THE REMOTE IDP METADATA XML URL>"
#          data:
#            providerId: "saml" #do not change this
#            alias: "<A UNIQUE ALIAS NAME>"
#            enabled: true
#            authenticateByDefault: false
#            firstBrokerLoginFlowAlias: "first broker login"
#            postBrokerLoginFlowAlias: ""
#            storeToken: ""
#            addReadTokenRoleOnCreate: ""
#            trustEmail: ""
#            linkOnly: ""
#            displayName: "<THE DESIRED DISPLAY NAME>"
#            config:
#              useJwksUrl: "true"
#              syncMode: "IMPORT"
#              principalType: "SUBJECT"
#              signatureAlgorithm: "RSA_SHA256"
#              xmlSigKeyInfoKeyNameTransformer: "KEY_ID"
#              allowCreate: "false"
#              guiOrder: 1
#              entityId: "<THE ENTITY ID>"
#              authnContextComparisonType: "exact"
#              hideOnLoginPage: "false"
#              promotedLoginbutton: ""
#              backchannelSupported: ""
#              postBindingResponse: "true"
#              postBindingAuthnRequest: "true"
#              postBindingLogout: "true"
#              wantAuthnRequestsSigned: "true"
#              wantAssertionsSigned: "true"
#              wantAssertionsEncrypted: "true"
#              forceAuthn: ""
#              signSpMetadata: ""
#              loginHint: "false"
#              addExtensionsElementWithKeyInfo: "false"
#              attributeConsumingServiceName: "<ADD A NAME HERE>"
#              multiplePrincipals: "[{\"principalType\":\"ATTRIBUTE\",\"principalAttribute\":\"urn:oasis:names:tc:SAML:attribute:subject-id\"}]"
#              allowedClockSkew: ""
#              attributeConsumingServiceIndex: ""
#      social_idps:
#        - providerId: "google" #do not change this
#          alias: "google"  #do not change this
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          addReadTokenRoleOnCreate: ""
#          config:
#            clientId: "<CLIENT ID>"
#            clientSecret: "<CLIENT SECRET>"
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            acceptsPromptNoneForwardFromClient: ""
#            disableUserInfo: ""  #boolean
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean
#            defaultScope: ""
#            hostedDomain: ""
#            userIp: ""  #boolean
#            offlineAccess: ""  #boolean
#            conditionalTrustEmail: "" #boolean
#        - providerId: "github" #do not change this
#          alias: "github"  #do not change this
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          addReadTokenRoleOnCreate: ""
#          config:
#            clientId: "<CLIENT ID>"
#            clientSecret: "<CLIENT SECRET>"
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            acceptsPromptNoneForwardFromClient: ""
#            disableUserInfo: ""  #boolean
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean
#            defaultScope: ""
#        - providerId: "linkedin" #do not change this
#          alias: "linkedin"  #do not change this
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          addReadTokenRoleOnCreate: ""
#          config:
#            clientId: "<CLIENT ID>"
#            clientSecret: "<CLIENT SECRET>"
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            acceptsPromptNoneForwardFromClient: ""
#            disableUserInfo: ""  #boolean
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean
#            defaultScope: ""
#        - providerId: "facebook" #do not change this
#          alias: "facebook"  #do not change this
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          config:
#            clientId: "<CLIENT ID>"
#            clientSecret: "<CLIENT SECRET>"
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            addReadTokenRoleOnCreate: ""
#            acceptsPromptNoneForwardFromClient: ""
#            disableUserInfo: ""  #boolean
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean
#            defaultScope: ""
#            fetchedFields: ""
#        - providerId: "instagram" #do not change this
#          alias: "instagram" #do not change this
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          addReadTokenRoleOnCreate: ""
#          config:
#            clientId: "<CLIENT ID>"
#            clientSecret: "<CLIENT SECRET>"
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            acceptsPromptNoneForwardFromClient: ""
#            disableUserInfo: ""  #boolean
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean
#            defaultScope: ""
#        - providerId: "microsoft" #do not change this
#          alias: "microsoft" #do not change this
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          addReadTokenRoleOnCreate: ""
#          config:
#            clientId: "<CLIENT ID>"
#            clientSecret: "<CLIENT SECRET>"
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            acceptsPromptNoneForwardFromClient: ""
#            disableUserInfo: ""  #boolean
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean
#            defaultScope: ""
#        - providerId: "bitbucket" #do not change this
#          alias: "bitbucket" #do not change this
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          addReadTokenRoleOnCreate: ""
#          config:
#            clientId: "<CLIENT ID>"  # consumer key
#            clientSecret: "<CLIENT SECRET>"  # consumer secret
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean
#            defaultScope: ""
#        - providerId: "twitter" #do not change this
#          alias: "twitter" #do not change this
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          addReadTokenRoleOnCreate: ""
#          config:
#            clientId: "<CLIENT ID>"
#            clientSecret: "<CLIENT SECRET>"
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            acceptsPromptNoneForwardFromClient: ""
#            disableUserInfo: ""  #boolean
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean
#            defaultScope: ""
#        - providerId: "gitlab" #do not change this
#          alias: "gitlab" #do not change this
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          addReadTokenRoleOnCreate: ""
#          config:
#            clientId: "<CLIENT ID>"  # application id
#            clientSecret: "<CLIENT SECRET>"  # application secret
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean
#            defaultScope: ""
#        - providerId: "paypal" #do not change this
#          alias: "paypal" #do not change this
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          addReadTokenRoleOnCreate: ""
#          config:
#            clientId: "<CLIENT ID>"
#            clientSecret: "<CLIENT SECRET>"
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            sandbox: ""  #boolean
#            acceptsPromptNoneForwardFromClient: ""
#            disableUserInfo: ""  #boolean
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean
#            defaultScope: ""
#        - providerId: "stackoverflow" #do not change this
#          alias: "stackoverflow" #do not change this
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          addReadTokenRoleOnCreate: ""
#          config:
#            clientId: "<CLIENT ID>"
#            clientSecret: "<CLIENT SECRET>"
#            key: "<USE A KEY>"
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            acceptsPromptNoneForwardFromClient: ""
#            disableUserInfo: ""  #boolean
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean
#            defaultScope: ""
#        - providerId: "openshift-v4" #do not change this
#          alias: "use-an-alias-here-too"
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          addReadTokenRoleOnCreate: ""
#          config:
#            clientId: "<CLIENT ID>"
#            clientSecret: "<CLIENT SECRET>"
#            baseUrl: ""
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            disableUserInfo: ""  #boolean
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean
#        - providerId: "openshift-v3" #do not change this
#          alias: "use-an-alias-here-too"
#          trustEmail: ""  #boolean
#          storeToken: ""   #boolean
#          linkOnly: ""    #boolean
#          firstBrokerLoginFlowAlias: "first broker login"
#          postBrokerLoginFlowAlias: ""
#          enabled: true
#          authenticateByDefault: false
#          addReadTokenRoleOnCreate: ""
#          config:
#            clientId: "<CLIENT ID>"
#            clientSecret: "<CLIENT SECRET>"
#            baseUrl: ""
#            useJwksUrl: "true"
#            syncMode: "IMPORT"  #could be one of {IMPORT, LEGACY, FORCE}
#            disableUserInfo: ""  #boolean
#            hideOnLoginPage: ""  #boolean
#            promotedLoginbutton: ""   #boolean

